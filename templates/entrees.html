<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Livraisons Bar</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
    .navbar { background-color: #1c1c2b !important; }
    .logo { max-height: 50px; }
    .card { border-radius: 1rem; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
    .table-hover tbody tr:hover { background-color: #f1f1f1; }
    footer { background:#f1f1f1; border-top:1px solid #ddd; }
    .badge-round { border-radius: 999px; }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark px-4">
  <a class="navbar-brand d-flex align-items-center" href="/">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo me-2">
    <span class="text-white fw-bold"></span>
  </a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ms-auto">
      {% set nav_links = [
        ('home', 'Accueil'),
        ('ajouter', 'Ingr√©dients'),
        ('recettes', 'Recettes'),
        ('ventes', 'Ventes'),
        ('transfert', 'Entr√©es (cuisine)'),
        ('pointage_bar', 'Bar'),
        ('entrees_boissons', 'Livraisons Bar')
      ] %}
      {% for endpoint, label in nav_links %}
      <li class="nav-item">
        <a class="nav-link {{ 'active text-warning fw-bold' if request.path == url_for(endpoint) else '' }}"
           href="{{ url_for(endpoint) }}">{{ label }}{% if endpoint == 'ajouter' and nb_alertes > 0 %} <span class="badge bg-danger rounded-pill">{{ nb_alertes }}</span>{% endif %}</a>
      </li>
      {% endfor %}
      <li class="nav-item ms-3 d-flex align-items-center">
        <span class="text-white-50 me-2 small">{{ current_user.username }}</span>
        <a class="nav-link text-warning" href="{{ url_for('logout') }}">D√©connexion</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container mt-5">

  <h1 class="text-center mb-4">üì¶ Livraisons Bar (Entr√©es de boissons)</h1>

  <!-- Formulaire d‚Äôenregistrement d‚Äôune entr√©e -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">‚ûï Nouvelle livraison</div>
    <div class="card-body">
      <form method="POST" action="{{ url_for('entrees_boissons') }}">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Date</label>
            <input type="date" name="date" class="form-control" required>
          </div>
          <div class="col-md-5">
            <label class="form-label">Boisson</label>
            <select name="boisson_id" class="form-select" required>
              {% for b in boissons %}
                <option value="{{ b.id }}">{{ b.nom }} ({{ b.prix_unitaire }} F)</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Quantit√©</label>
            <input type="number" step="0.01" name="quantite" class="form-control" required>
          </div>
          <div class="col-md-10">
            <label class="form-label">Note (optionnel)</label>
            <input type="text" name="note" class="form-control" placeholder="Ex : Guinness ‚Äì jour 1/3">
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button class="btn btn-success w-100">
              <i class="bi bi-box-seam me-1"></i> Enregistrer
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Filtres -->
  <div class="card mb-3">
    <div class="card-header bg-secondary text-white">üîé Filtrer les livraisons</div>
    <div class="card-body">
      <form method="GET" action="{{ url_for('entrees_boissons') }}" class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Boisson</label>
          <select name="boisson_id" class="form-select">
            <option value="">Toutes</option>
            {% for b in boissons %}
              <option value="{{ b.id }}" {% if boisson_id_f and boisson_id_f == b.id %}selected{% endif %}>{{ b.nom }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Du</label>
          <input type="date" name="date_debut" class="form-control" value="{{ date_debut }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">Au</label>
          <input type="date" name="date_fin" class="form-control" value="{{ date_fin }}">
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-primary w-100">
            <i class="bi bi-funnel me-1"></i> Filtrer
          </button>
        </div>
      </form>
      {% if total_filtre is not none %}
      <div class="mt-3">
        <span class="badge bg-light text-dark border badge-round">
          Total filtr√© : <strong>{{ '%.2f'|format(total_filtre) }}</strong>
        </span>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Historique des entr√©es (filtr√©) -->
  <div class="card">
    <div class="card-header bg-dark text-white">üóÇÔ∏è Entr√©es (r√©sultats)</div>
    <div class="card-body table-responsive">
      {% if recent.items %}
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:130px">Date</th>
            <th>Boisson</th>
            <th class="text-end" style="width:150px">Quantit√©</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          {% for e in recent.items %}
          <tr>
            <td>{{ e.date }}</td>
            <td>{{ e.boisson.nom }}</td>
            <td class="text-end">{{ '%.2f'|format(e.quantite) }}</td>
            <td>{{ e.note }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if recent.pages > 1 %}
      <nav class="mt-3">
        <ul class="pagination pagination-sm justify-content-center mb-0">
          <li class="page-item {% if not recent.has_prev %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('entrees_boissons', page=recent.prev_num, boisson_id=boisson_id_f, date_debut=date_debut, date_fin=date_fin) }}">‚Äπ Pr√©c√©dent</a>
          </li>
          <li class="page-item disabled">
            <span class="page-link">Page {{ recent.page }} / {{ recent.pages }}</span>
          </li>
          <li class="page-item {% if not recent.has_next %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('entrees_boissons', page=recent.next_num, boisson_id=boisson_id_f, date_debut=date_debut, date_fin=date_fin) }}">Suivant ‚Ä∫</a>
          </li>
        </ul>
      </nav>
      {% endif %}
      {% else %}
        <p class="text-muted mb-0">Aucune entr√©e pour ce filtre.</p>
      {% endif %}
    </div>
  </div>

  <div class="text-end mt-3">
    <a class="btn btn-outline-secondary" href="{{ url_for('pointage_bar') }}">‚Üê Retour au Bar</a>
  </div>

</div>

<footer class="mt-5 py-4 text-center text-muted">
  ¬© {{ current_time.year }} Lotus Garden Stock Manager by Melvina MIGAN ‚Äî Tous droits r√©serv√©s.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
